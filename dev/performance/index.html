<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Performance · NFFT</title><link rel="canonical" href="https://tknopp.github.io/NFFT.jl/performance/"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.png" alt="NFFT logo"/></a><div class="docs-package-name"><span class="docs-autofit">NFFT</span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../background/">Background</a></li><li><a class="tocitem" href="../overview/">Overview</a></li><li><a class="tocitem" href="../abstract/">AbstractNFFTs</a></li><li class="is-active"><a class="tocitem" href>Performance</a><ul class="internal"><li><a class="tocitem" href="#Accuracy"><span>Accuracy</span></a></li><li><a class="tocitem" href="#Performance"><span>Performance</span></a></li><li><a class="tocitem" href="#Multi-Threading"><span>Multi-Threading</span></a></li></ul></li><li><a class="tocitem" href="../tools/">Tools</a></li><li><a class="tocitem" href="../api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Performance</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Performance</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/JuliaMath/NFFT.jl/blob/master/docs/src/performance.md#" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Accuracy-and-Performance"><a class="docs-heading-anchor" href="#Accuracy-and-Performance">Accuracy and Performance</a><a id="Accuracy-and-Performance-1"></a><a class="docs-heading-anchor-permalink" href="#Accuracy-and-Performance" title="Permalink"></a></h1><p>On this page, the accuracy and the performance of NFFT.jl are investigated. For comparison we use the C library NFFT3 and the C++ library FINUFFT. The shown data are useful for understanding the performance characteristics of the NFFT and help choosing the parameters accordingly.</p><h2 id="Accuracy"><a class="docs-heading-anchor" href="#Accuracy">Accuracy</a><a id="Accuracy-1"></a><a class="docs-heading-anchor-permalink" href="#Accuracy" title="Permalink"></a></h2><p>We start with the accuracy. The following plot shows the relative error of a 2D NFFT (<span>$N=(64,64), M=64^2$</span>) compared to the NDFT for different choices of <span>$m$</span> and <span>$\sigma = 2$</span>:</p><p><img src="../assets/accuracy_m_D2.svg" alt="Accurracy"/></p><p>What can be seen is that the error decreases exponentially with <span>$m$</span>. For about <span>$m=8$</span> the error reaches the machine precision and the NFFT then can be considered to be exact in floating point arithmetics. </p><p>In practice, however, one often uses <code>Float32</code> instead of <code>Float64</code> in which cases <span>$m$</span>  can be chosen much smaller. If the values encoded in the NFFT vectors are for instance images, a value of <span>$m = 3$</span> or <span>$m = 4$</span> is often sufficient since the human eye can only discriminate about three orders of magnitude in gray values.</p><p>Next we fix <span>$m$</span> and look at different oversampling parameters:</p><p><img src="../assets/accuracy_sigma_D2.svg" alt="Accurracy"/></p><p>FINUFFT is not included in this plot since it does not allow to adjust the oversampling factor freely. One can see that the accuracy improves with increasing oversampling factor. However, one needs to keep in mind that the memory consumption of the NFFT increases with <span>$\sigma^D$</span> and in turn one usually keeps it below 2. One rule of thumb is to use <span>$\sigma=2$</span> if memory consumption is no concern and switch to <span>$\sigma = 1.25$</span> with an accordingly increased <span>$m$</span> if memory consumption is a concern (e.g. for 3D transforms).</p><p>In both figures one can see that independent implementations reach very similar accuracy. There are some smaller implementation details (different window functions, different kernel size handling) that slightly affect the accuracy. For instance NFFT3 uses a kernel size of <span>$(2m+2)^D$</span> while NFFT.jl and FINUFFT use <span>$(2m)^D$</span>.</p><h2 id="Performance"><a class="docs-heading-anchor" href="#Performance">Performance</a><a id="Performance-1"></a><a class="docs-heading-anchor-permalink" href="#Performance" title="Permalink"></a></h2><p>Next, we investigate the performance of the NFFT and benchmark the following three operations:</p><ul><li>forward NFFT</li><li>adjoint NFFT</li></ul><p>The parameters for the benchmark are </p><ul><li><span>$N_\text{1D}=(8192,), N_\text{2D}=(64,64), N_\text{3D}=(32,32,32)$</span></li><li><span>$M=N^2$</span></li><li><span>$m=3, \dots, 8$</span></li><li><span>$\sigma = 2$</span></li><li>1 thread</li><li>sorted random nodes</li></ul><p>All benchmarks are performed with <code>@belapsed</code> from <a href="https://github.com/JuliaCI/BenchmarkTools.jl">BenchmarkTools.jl</a> which takes the minimum of several runs (10 s upper benchmark time). The benchmark is run on a computer with 2 AMD EPYC 7702 CPUs running at 2.0 GHz (256 cores in total) and a main memory of 1024 GB. The benchmark suite is described <a href="https://github.com/JuliaMath/NFFT.jl/blob/master/benchmark/Project.toml">here</a>.</p><p>The results for <span>$D=1,\dots,3$</span> are shown in the following graphics. In these graphics we plot the performance versus the accuracy for various <span>$m$</span>. This allows to account for the slight accuracy differences discussed earlier.</p><p><img src="../assets/performanceVsAccuracy_D1.svg" alt="Performance vs Accurracy 1D"/> <img src="../assets/performanceVsAccuracy_D2.svg" alt="Performance vs Accurracy 2D"/> <img src="../assets/performanceVsAccuracy_D3.svg" alt="Performance vs Accurracy 3D"/></p><p>The results show that all three packages are within the same order of magnitude performance. NFFT.jl is fastest for 1D and 2D while in 3D NFFT.jl and FINUFFT are close together for the forward NFFT and FINUFFT is faster for large <span>$m$</span> and the adjoint NFFT. </p><h2 id="Multi-Threading"><a class="docs-heading-anchor" href="#Multi-Threading">Multi-Threading</a><a id="Multi-Threading-1"></a><a class="docs-heading-anchor-permalink" href="#Multi-Threading" title="Permalink"></a></h2><p>Next, we we look at the multi-threading performance and this time keep <span>$m$</span> fixed but include different precomputation strategies and also look at the precomputation time.</p><p>The parameters for this benchmark are </p><ul><li><span>$N=(64,64)$</span></li><li><span>$M=64^2$</span></li><li><span>$m=4$</span></li><li><span>$\sigma = 2$</span></li><li>1, 2, 4, 8 threads</li><li>precompute <code>NFFT.LUT</code> and <code>NFFT.TENSOR</code> for NFFT.jl and NFFT3</li><li>sorted random nodes</li></ul><p>The results are shown in the following graphic:</p><p><img src="../assets/performance_mt_2_1024_1048576.svg" alt="Performance Multi-threaded"/></p><p>Observations:</p><ul><li>All packages are within a factor of about three.</li><li>They are properly multi-threaded and scale with the number of threads.</li><li><code>NFFT.TENSOR</code> is faster than <code>NFFT.LUT</code> but has larger precomputation time.</li></ul></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../abstract/">« AbstractNFFTs</a><a class="docs-footer-nextpage" href="../tools/">Tools »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Sunday 13 February 2022 10:12">Sunday 13 February 2022</span>. Using Julia version 1.7.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
